# Use Ubuntu 16.04 (Xenial) as the base image
FROM ubuntu:16.04

# Install required packages
RUN apt-get update && apt-get install -y \
    apache2 \
    libapache2-mod-php7.0 \
    php7.0 \
    php7.0-cli \
    php7.0-common \
    php7.0-mysql \
    php7.0-gd \
    php7.0-bz2 \
    php7.0-xsl \
    php7.0-zip \
    php7.0-bcmath \
    php7.0-sockets \
    php7.0-tokenizer \
    php7.0-curl \
    php7.0-dev \  
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

# Enable Apache rewrite and php7.0 modules
RUN a2enmod rewrite && a2enmod php7.0

# Install Xdebug using pecl and create its configuration
RUN pecl install xdebug-2.5.5

RUN { \
    echo 'display_errors = On'; \
    echo 'display_startup_errors = On'; \
    echo 'error_reporting = E_ALL'; \
    echo 'html_errors = On'; \
    echo 'zend_extension=/usr/lib/php/20151012/xdebug.so'; \
    echo 'xdebug.remote_enable = 1'; \
    echo 'xdebug.remote_autostart = 1'; \
    echo 'xdebug.remote_host = 172.20.28.159'; \
    echo 'xdebug.remote_port = 9000'; \
    echo 'xdebug.idekey=VSCODE'; \
    # echo 'xdebug.remote_log = /var/log/xdebug.log'; \
    # echo 'xdebug.client_host=host.docker.internal'; \
    # echo 'xdebug.client_port=9000'; \
    # echo 'xdebug.mode = debug'; \
    # echo 'xdebug.discover_client_host=1'; \
} >> /etc/php/7.0/apache2/php.ini

# Set up a custom virtual host configuration
COPY custom-virtual-host.conf /etc/apache2/sites-available/
RUN ln -s /etc/apache2/sites-available/custom-virtual-host.conf /etc/apache2/sites-enabled/

# Start Apache in foreground
CMD ["apache2ctl", "-D", "FOREGROUND"]